<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BBB AO VIVO</title>
    
    <!-- Favicon (√≠cone da aba do navegador) -->
<link rel="icon" href="https://i.imgur.com/Wfiv3jE.png" type="https://i.imgur.com/Wfiv3jE.png">
    
<style>
:root {
    --bg: #0a0a0d;
    --panel: #18181b;
    --border: #27272a;
    --primary: #6366f1;
    --text: #f4f4f5;
    --muted: #a1a1aa;
}

/* GERAL */
* { box-sizing: border-box; }
body {
    background: var(--bg);
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Arial, sans-serif;
    margin: 0;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}

/* HEADER */
header {
    padding: 10lpx 20px;
    font-size: 1.2rem;
    font-weight: bold;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
    
    header h1 {
    font-size: 1.1rem;
    margin: 0;
}
header span { color: var(--primary); }
  
  #btnAjuda {
    background: rgba(99,102,241,0.15); /* lil√°s suave */
    border: 1px solid rgba(99,102,241,0.6);
    color: var(--primary);
    padding: 7px 16px;
    border-radius: 999px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.85rem;

    transition:
        background 0.25s ease,
        box-shadow 0.25s ease,
        transform 0.2s ease;
}

#btnAjuda:hover {
    background: rgba(99,102,241,0.25);
    box-shadow: 0 0 0 3px rgba(99,102,241,0.25);
    transform: translateY(-1px);
}

#btnAjuda:active {
    transform: scale(0.96);
}

/* PLAYER */
.player-container {
    width: 100%;
    aspect-ratio: 16 / 9;
    background: black;
    position: relative;

}
.player-container iframe {
    width: 100%;
    height: 100%;
    border: none;
}
  
 #playerPlaceholder {
    position:absolute;
    inset:0;
    display:flex;
    align-items:center;
    justify-content:center;
    color:#a1a1aa;
    font-size:1rem;
    background:black;
    z-index:2;
}
  
.player-container::after {
    content: "Carregando c√¢mera...";
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0,0,0,.45);
    color: var(--muted);
    font-size: .9rem;
    pointer-events: none;
    opacity: 0;
    transition: .25s;
    z-index: 3;
}
  
 .player-container.loading::after {
    opacity: 1;
}
  

/* CAMERAS HORIZONTAL SCROLL */
.cam-track {
    display: flex;
    gap: 10px;
    padding: 4px 15px;
    overflow-x: auto;
    scroll-behavior: smooth;
    background: #111114;
}

    /* IN√çCIO: NOVO C√ìDIGO - Estilos para Scrollbar e Cursor do Cam-Track */
    .cam-track {
        -webkit-overflow-scrolling: touch; /* Melhora a rolagem em iOS */
        cursor: grab; /* Cursor padr√£o para indicar que pode ser arrastado */
    }

    .cam-track.grabbing {
        cursor: grabbing; /* Cursor quando o usu√°rio est√° arrastando */
        user-select: none; /* Impede a sele√ß√£o de texto durante o arrasto */
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
    }

    /* Estilo da Scrollbar para Webkit (Chrome, Safari) */
    .cam-track::-webkit-scrollbar {
        height: 8px; /* Altura da barra de rolagem */
    }

    .cam-track::-webkit-scrollbar-track {
        background: #111114; /* Fundo da trilha da scrollbar, combinando com o fundo do cam-track */
    }

    .cam-track::-webkit-scrollbar-thumb {
        background: var(--primary);  /* Cor lil√°s suave do 'primary' com transpar√™ncia */
        border-radius: 10px; /* Bordas arredondadas */
        border: 2px solid #111114; /* Borda para centralizar o "thumb" e parecer mais discreto */
    }

    .cam-track::-webkit-scrollbar-thumb:hover {
        background: rgba(99, 102, 241, 0.7); /* Mais vis√≠vel no hover */
    }

    /* Estilo da Scrollbar para Firefox (se for o caso) */
    .cam-track {
        scrollbar-width: thin; /* Largura fina da scrollbar */
        scrollbar-color: rgba(99, 102, 241, 0.4) #111114; /* Cor do 'thumb' e do 'track' */
    }
    /* FIM: NOVO C√ìDIGO */

.cam-card {
    min-width: 95px;
    height: 45px;
    background: #27272a;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: 2px solid transparent;
    transition: .25s;
    font-size: .8rem;
    font-weight: 600;
}
.cam-card:hover { transform: scale(1.1); border-color: var(--active); color: var(--accent); }
    
    /* Bot√£o ativo da c√¢mera */
.cam-card.active {
    border-color: var(--primary); /* borda lil√°s */
    transform: scale(1.1); /* aumenta levemente */
}
    

/* CONTAINER DO SANDBOX + ONLINE */ 


/* CAIXA ONLINE */
#onlineBox {
  display: flex;
    align-items: center;
    gap: 6px;
    font-size: .7rem;
}

/* MODAL DE AVISO */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}
    
.modalContent {
    background: rgba(31, 31, 46, 0.85); /* fundo escuro com transpar√™ncia tipo modal nome */
    backdrop-filter: blur(6px);         /* efeito emba√ßado */
    color: #fff;
    border-radius: 18px;
    border: 1px solid rgba(99,102,241,0.35); /* borda lil√°s suave */
    padding: 26px;
    max-width: 400px;
    width: 90%;
    text-align: center;
    position: relative;
    box-shadow: 
        0 0 0 1px rgba(99,102,241,0.15),
        0 20px 50px rgba(0,0,0,0.75);
}
    
.modalContent img {
    max-width: 100%;
    max-height: 200px;
    margin-bottom: 15px;
    border-radius: 8px;
}
    
.modalContent button {
    padding: 10px 16px;
    background: var(--primary);  /* lil√°s */
    border: none;
    color: #fff;                 /* texto branco */
    font-weight: bold;
    border-radius: 8px;
    cursor: pointer;
    margin-top: 15px;
    transition: 0.2s;
}

.modalContent button:hover {
    background: #7c7fff;  /* lil√°s mais claro ao passar o mouse */
}
    
    /* anima√ß√£o de abrir e fechar modal */
@keyframes fadeInScale {
  0% { opacity: 0; transform: scale(0.95); }
  100% { opacity: 1; transform: scale(1); }
}

@keyframes fadeOutScale {
  0% { opacity: 1; transform: scale(1); }
  100% { opacity: 0; transform: scale(0.95); }
}

/* ao mostrar */
.modal.show .modalContent {
  animation: fadeInScale 0.25s ease forwards;
}

/* ao esconder */
.modal.hide .modalContent {
  animation: fadeOutScale 0.25s ease forwards;
}
    

/* CHAT */
.chat-container {
    width: auto;
    background: #111;
    border-left: 1px solid var(--border);
    display: flex;
    flex-direction: column;
}


.messages {
    height: 295px;
    padding: 12px 20px;
    overflow-y: auto;
    word-wrap: break-word;
    white-space: pre-wrap;
    background: #0f0f12;
}


.msg {
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 12px;
    border-radius: 12px;
    margin-bottom: 8px;
    font-size: 14px;
    animation: msgAppear 0.4s ease;
}




.input-area {
    display: flex;
    gap: 5px;
    padding: 6px 15px 12px;
    background: transparent;
    border-top: 1px solid var(--border);
    flex-shrink: 0;
    position: relative; /* Adicione esta linha */
    flex-wrap: wrap; /* Permite que o input e o bot√£o quebrem linha se o preview for grande, embora n√£o deve acontecer */
    align-items: flex-end; /* Alinha os itens para baixo quando o preview est√° acima */
}

.input-area input {
    flex: 1;
    background: #1b1b24; /* fundo destacado */
    border: 0.7px solid #6366f1; /* lil√°s */
    border-radius: 14px;
    padding: 12px 18px;
    color: #fff;
    outline: none;
    font-size: 14px;
}

/* Placeholder */
.input-area input::placeholder {
    color: #a1a1aa;
}

/* Quando clica */
.input-area input:focus {
    border-color: var(--primary);
}

button {
    background: #fff;
    color: #000;
    border: none;
    border-radius: 14px;
    padding: 0 20px;
    font-size: 18px;
    cursor: pointer;
}

/* MODAL NOME ‚Äî ESTILO LIL√ÅS */
.name-modal {
    position: fixed;
    inset: 0;
    background: rgba(10,10,20,0.75);
    backdrop-filter: blur(6px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
}

.name-box {
    background: linear-gradient(
        180deg,
        #1f1f2e,
        #141420
    );
    padding: 26px;
    border-radius: 18px;
    width: 85%;
    max-width: 320px;
    text-align: center;

    border: 1px solid rgba(99,102,241,0.35);
    box-shadow:
        0 0 0 1px rgba(99,102,241,0.15),
        0 20px 50px rgba(0,0,0,0.75);
    
    animation: fadeIn 0.3s ease;
}

.name-box h2 {
    margin: 0 0 8px;
    font-size: 1.1rem;
    font-weight: 700;
    color: #f4f4f5;
}

.name-box p {
    font-size: 0.8rem;
    color: var(--muted);
    margin-bottom: 16px;
}

.name-box input {
    width: 100%;
    background: #0f0f16;
    border: 1px solid rgba(99,102,241,0.35);
    border-radius: 12px;
    padding: 12px 14px;
    color: white;
    outline: none;
    margin-bottom: 16px;
}

.name-box input:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 2px rgba(99,102,241,0.25);
}

    /* IN√çCIO: NOVO C√ìDIGO - Estilo para Mensagem de Erro do Nome */
    .name-box .name-error {
        color: #ef4444; /* Cor vermelha para o erro */
        font-size: 0.75rem; /* Tamanho discreto */
        margin-top: -10px; /* Ajusta a margem para ficar mais pr√≥ximo do input */
        margin-bottom: 15px; /* Espa√ßamento com o bot√£o */
        text-align: center;
        font-weight: 500;
        animation: fadeIn 0.3s ease; /* Anima√ß√£o suave */
    }
    /* FIM: NOVO C√ìDIGO */

.name-box button {
    width: 100%;
    background: linear-gradient(
        135deg,
        #6366f1,
        #7c7fff
    );
    border: none;
    border-radius: 12px;
    padding: 12px;
    font-weight: 700;
    color: white;
    cursor: pointer;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.name-box button:hover {
    box-shadow: 0 10px 25px rgba(99,102,241,0.45);
    transform: translateY(-1px);
}

.name-box button:active {
    transform: scale(0.96);
}  
  
  /* MODAIS */
.modal {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,.7);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.modal-box {
    background: #18181b;
    border: 1px solid var(--border);
    border-radius: 14px;
    padding: 28px;
    width: 90%;
    max-width: 520px;
}

.modal-box h2 {
    margin-top: 0;
}

.help-cards {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
}

.help-card {
    background: #0f0f12;
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 16px;
}

.help-card h3 {
    margin: 0 0 6px;
    font-size: .95rem;
    color: var(--primary);
}

.help-card p {
    font-size: .85rem;
    color: var(--muted);
    line-height: 1.4;
}

.close-help {
    margin-top: 18px;
    width: 100%;
    padding: 12px;
    border-radius: 8px;
    border: none;
    background: var(--primary);
    color: white;
    font-weight: 600;
    cursor: pointer;
}
  
   /* BOT√ÉO ‚ò∞ */
.menu-btn {
    background: transparent;
    border: none;
    color: white;
    font-size: 1.7rem;
    cursor: pointer;
    padding: 6px 10px;
    border-radius: 10px;
    transition: 
        background 0.25s ease,
        transform 0.25s cubic-bezier(.34,1.56,.64,1);
}

.menu-btn:hover {
    background: rgba(255,255,255,0.12);
    transform: scale(1.05);
}

/* OVERLAY */
.side-menu {
    position: fixed;
    inset: 0;
    background: radial-gradient(
        circle at left,
        rgba(0,0,0,0.7),
        rgba(0,0,0,0.9)
    );
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.35s ease;
    z-index: 1000;
}
  
    /* ANIMA√á√ÉO E ACORDE√ÉO */
.help-content {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.35s ease;
  margin-top: 0;
}

.help-title {
  cursor: pointer;
  user-select: none;
}

.help-card.active .help-content {
  max-height: 1000px; /* Valor grande o suficiente para o conte√∫do */
  margin-top: 10px;
}
  
    /* Anima√ß√£o do modal */
@keyframes fadeIn {
  from { opacity: 0; transform: scale(0.95); }
  to { opacity: 1; transform: scale(1); }
}

@keyframes fadeOut {
  from { opacity: 1; transform: scale(1); }
  to { opacity: 0; transform: scale(0.95); }
}

.modal.show {
  display: flex;
  animation: fadeIn 0.25s ease forwards;
}

.modal.hide {
  animation: fadeOut 0.25s ease forwards;
}
  
  /* ATIVO */
.side-menu.active {
    opacity: 1;
    pointer-events: auto;
}

.side-menu.active .side-menu-content {
    transform: translateX(0) scale(1);
}

/* PERFIL */
.menu-profile {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 30px;
    opacity: 0;
    transform: translateY(10px);
    transition: 0.4s ease;
}

.side-menu.active .menu-profile {
    opacity: 1;
    transform: translateY(0);
}

.profile-icon {
    width: 46px;
    height: 46px;
    border-radius: 50%;
    background: linear-gradient(145deg, #27272a, #18181b);
    box-shadow:
        inset 0 0 0 1px rgba(255,255,255,0.08),
        0 6px 16px rgba(0,0,0,0.6);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: #d4d4d8;
}

/* LINKS */
.menu-links {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.menu-links button {
    background:
        linear-gradient(
            135deg,
            rgba(255,255,255,0.06),
            rgba(255,255,255,0.02)
        );
    border: 1px solid rgba(255,255,255,0.08);
    color: white;
    padding: 14px 16px;
    border-radius: 14px;
    cursor: pointer;
    text-align: left;
    font-size: 0.95rem;

    opacity: 0;
    transform: translateY(12px) scale(0.96);
    transition:
        transform 0.35s cubic-bezier(.34,1.56,.64,1),
        opacity 0.35s ease,
        box-shadow 0.25s ease;
}

/* entrada em cascata */
.side-menu.active .menu-links button {
    opacity: 1;
    transform: translateY(0) scale(1);
}

.menu-links button:nth-child(1) { transition-delay: 0.12s; }
.menu-links button:nth-child(2) { transition-delay: 0.18s; }
.menu-links button:nth-child(3) { transition-delay: 0.24s; }

/* hover PREMIUM */
.menu-links button:hover {
    box-shadow:
        0 10px 25px rgba(0,0,0,0.5),
        inset 0 0 0 1px rgba(255,255,255,0.15);
    transform: scale(1.04);
}

/* clique */
.menu-links button:active {
    transform: scale(0.96);
}
  
    
    /* Anima√ß√£o de mensagem aparecendo */
@keyframes msgAppear {
    0% { opacity: 0; transform: translateY(10px); }
    100% { opacity: 1; transform: translateY(0); }
}

.msg {
    animation: msgAppear 0.4s ease;
}
    
   body, html {
    margin: 0;
    padding: 0;
    height: 100%;
}

.app {
    height: 100vh;
    display: flex;
    flex-direction: column;
    background: #0a0a0d;
}
    
   /* Mensagem do ADMIN */
/* Mensagem do ADMIN */
.admin-msg {
    background-color: #5752d4; /* lil√°s escuro */
    color: #ffffff;            /* texto branco */
    padding: 8px 12px;
    border-radius: 12px;
    margin-bottom: 8px;
    font-size: 14px;           /* mesma fonte das mensagens normais */
    word-wrap: break-word;
    white-space: pre-wrap;
}

    
    /* CONTAINER */
.side-menu-content {
    width: 280px;
    height: 100%;
    background:
        linear-gradient(
            180deg,
            #1f1f26,
            #0c0c10
        );
    padding: 24px;
    transform: translateX(-110%) scale(0.98);
    transition:
        transform 0.45s cubic-bezier(.22,1,.36,1);
    box-shadow:
        12px 0 40px rgba(0,0,0,0.7),
        inset -1px 0 rgba(255,255,255,0.06);
}
    
    .layout {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 60px); /* altura menos o header */
}

    /* BOT√ÉO ENVIAR CHAT (LIL√ÅS) */
#sendBtn {
    background: linear-gradient(
        135deg,
        #6366f1,
        #7c7fff
    );
    color: white;
    border-radius: 14px;
    padding: 0 20px;
    height: 40px;
    font-size: 18px;
    cursor: pointer;

    box-shadow:
        0 8px 20px rgba(99,102,241,0.45);

    transition:
        transform 0.2s ease,
        box-shadow 0.2s ease;
}


#sendBtn:active {
    transform: scale(0.95);
}
    
    /* HEADER DO CHAT */
.chat-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 18px;   
    );
    border-top: 1px solid var(--border);
    border-bottom: 1px solid var(--border);
}

/* T√çTULO */
.chat-title {
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 1px;
    color: var(--muted);
}

/* STATUS ONLINE */
.online-status {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    color: #d4d4d8;
}

/* BOLINHA VERDE */
.online-status .dot {
    width: 8px;
    height: 8px;
    background: #22c55e;
    border-radius: 50%;
    box-shadow: 0 0 6px rgba(34,197,94,0.7);
}
    
    

/* ===== LAYOUT PRINCIPAL ===== */
.page {
  display: flex;
  flex-direction: column;
  height: calc(100vh - 60px); /* header */
}

/* ===== MOBILE (padr√£o) ===== */
.left-column {
  display: flex;
  flex-direction: column;
}

.chat {
  width: 100%;
}

/* ===== PC ===== */
@media (min-width: 1024px) {

  .page {
    flex-direction: row;
  }

  .left-column {
    flex: 2;
    display: flex;
    flex-direction: column;
    min-width: 0;
  }

  .player-container {
    height: 420px;
  }

  /* c√¢meras N√ÉO esticam mais a tela */
  .cam-track {
    max-width: 100%;
    overflow-x: auto;
    flex-shrink: 0;
  }

  .chat {
    flex: 1;
    display: flex;
    flex-direction: column;
    border-left: 1px solid var(--border);
  }

  /* CHAT COM ALTURA FIXA */
  .chat-container {
    display: flex;
    flex-direction: column;
    height: 100%;
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    height: auto; /* remove crescimento infinito */
  }

  .input-area {
    flex-shrink: 0;
  }
}


     /* ===== CORRE√á√ÉO MOBILE SEGURA ===== */

@supports (height: 100dvh) {
    .layout {
        height: calc(100dvh - 60px);
    }
}

@media (max-width: 768px) {
    body {
        min-height: 100dvh;
    }
} 
   
   

/* Estilo do timestamp dentro da mensagem */
.msg-time {
    font-size: 0.65rem; /* Fonte um pouco menor para ser discreto */
    color: #a1a1aa; /* Cor cinza mais pr√≥xima do muted, para boa visibilidade e discri√ß√£o */
    opacity: 0; /* Levemente mais vis√≠vel que antes */
    
    /* Posicionamento absoluto - flutua sobre o conte√∫do */
    position: absolute;
    right: 8px; /* Ajustado para um pouco mais pr√≥ximo da borda direita */
    bottom: 2px; /* Reduzido para ficar bem no cantinho inferior */
    white-space: nowrap; /* Evita que o hor√°rio quebre em v√°rias linhas */
    line-height: 1; /* Garante que a altura da linha n√£o afete o posicionamento */
    z-index: 1; /* Garante que ele fique por cima do texto, se houver sobreposi√ß√£o */
    background-color: transparent; /* Garante que n√£o tenha fundo que "cubra" o texto da mensagem */
}

/* Ajuste para a bolha da mensagem */
.msg {
    position: relative; /* FUNDAMENTAL para que o posicionamento absoluto do .msg-time funcione */
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 12px; /* **VOLTAMOS AO PADDING ORIGINAL** para n√£o aumentar a bolha */
    border-radius: 12px;
    margin-bottom: 8px;
    font-size: 14px;
    animation: msgAppear 0.4s ease;
    /* Removido o min-height, a bolha deve se adaptar ao seu conte√∫do */
}

/* Estilo para o conte√∫do da mensagem dentro da bolha */
.message-content {
    /* O texto deve ocupar o m√°ximo de espa√ßo, mas sem sobrepor o timestamp. */
    /* Usaremos padding-right para evitar que o texto invada a √°rea do timestamp */
    padding-right: 45px; /* Adiciona espa√ßo √† direita para o timestamp n√£o colidir com o texto */
    display: block; /* Garante que ele se comporte como um bloco para o padding funcionar bem */
    word-wrap: break-word; /* Garante que o texto quebre */
}

/* Estilo para o nome do usu√°rio */
.msg b {
    color: #aaa;
    font-weight: 500;
    margin-right: 5px; /* Espa√ßo entre o nome e a mensagem */
}

/* Ajustes para a mensagem de admin */
.admin-msg {
    background-color: #5752d4;
    color: #ffffff;
}
.admin-msg .msg-time { /* Opcional: ajustar cor do timestamp para admins */
    color: rgba(255, 255, 255, 0.7);
}
.admin-msg b {
    color: #ffffff;
}




/* --- ESTILOS PARA O SISTEMA DE REPLY --- */

/* Container do Preview de Resposta (mantenho como est√°, parece que est√° ok visualmente) */
/* Input-area agora √© o pai relativo */
.reply-preview-container {
    display: none; /* Esconde por padr√£o */
    background: #1b1b24; /* Fundo similar ao input */
    border-top: 1px solid var(--border);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    padding: 8px 12px;
    /* Removido o margin, agora o posicionamento √© absoluto */
    /* display: flex; */
    align-items: center;
    gap: 8px;
    position: absolute; /* Adicione esta linha */
    bottom: 100%; /* Posiciona acima do input-area, no topo */
    left: 0;
    right: 0;
    width: 100%; /* Garante que ele ocupe a largura total do input-area */
    box-sizing: border-box; /* Adicionado para padding n√£o aumentar a largura total */
    z-index: 10; /* Garante que ele fique por cima de outros elementos */
/* === C√ìDIGO DO FADE IN/OUT NO CSS === */
    opacity: 0; /* Come√ßa totalmente transparente */
    visibility: hidden; /* Escondido, n√£o interage√≠vel */
    transition: opacity 0.2s ease-out, visibility 0.2s step-end;
    /* A transi√ß√£o de visibility com step-end faz ele desaparecer completamente s√≥ no final da anima√ß√£o */
    /* === FIM C√ìDIGO DO FADE IN/OUT NO CSS === */
}

    .reply-preview-container.active {
        display: flex; /* Mantenha 'flex' para exibir o conte√∫do */
        /* === C√ìDIGO DO FADE IN/OUT NO CSS === */
        opacity: 1; /* Fica totalmente vis√≠vel */
        visibility: visible; /* Fica vis√≠vel e interage√≠vel */
        transition: opacity 0.2s ease-out, visibility 0.2s step-start;
        /* A transi√ß√£o de visibility com step-start faz ele aparecer imediatamente */
        /* === FIM C√ìDIGO DO FADE IN/OUT NO CSS === */
    }




    .reply-bar {
        width: 4px;
        height: 100%;
        background-color: var(--primary); /* Cor lil√°s */
        position: absolute;
        left: 0;
        top: 0;
        border-top-left-radius: 12px; /* NOVO: Arredonda o canto superior esquerdo */
        border-bottom-left-radius: 12px; /* NOVO: Arredonda o canto inferior esquerdo (se o preview tiver borda inferior arredondada tamb√©m) */
    }

.reply-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    padding-left: 8px; /* Espa√ßo para a barra lateral */
    min-width: 0; /* Permite que o conte√∫do encolha se necess√°rio */
}

.reply-name {
    font-weight: 600;
    color: var(--primary); /* Nome em destaque */
    font-size: 0.8rem;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2; /* Compacta a altura da linha */
}

.reply-text {
    font-size: 0.7rem; /* Levemente menor para ser discreto */
    color: var(--muted);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2; /* Compacta a altura da linha */
}

.cancel-reply-btn {
    background: none;
    border: none;
    color: var(--muted);
    font-size: 1.2rem;
    cursor: pointer;
    padding: 4px;
    line-height: 1;
    transition: color 0.2s ease;
    flex-shrink: 0; /* Garante que o bot√£o n√£o encolha */
}

.cancel-reply-btn:hover {
    color: var(--text);
}

/* --- ESTILOS PARA MENSAGENS RESPONDIDAS NO CHAT --- */

/* Ajuste para a bolha da mensagem. Remove paddings extras e deixa que o conte√∫do defina a altura. */
.msg {
    position: relative;
    background: rgba(255, 255, 255, 0.05);
    padding: 8px 12px; /* Mant√©m o padding original da bolha */
    border-radius: 12px;
    margin-bottom: 8px;
    font-size: 14px;
    animation: msgAppear 0.4s ease;
    /* Removi qualquer min-height ou padding-top/bottom extra para que a altura seja fluida */
    overflow: hidden; /* Garante que tudo dentro da bolha seja contido */
}

/* A bolha com reply n√£o precisa de padding-top extra, o margin-top do reply-box resolve. */
.msg.has-reply {
    /* padding-top: 5px; */ /* Removido: o margin-top do .msg-reply-box ser√° suficiente */
    padding-bottom: 15px; /* Mant√©m espa√ßo para o timestamp no canto inferior direito */
}

.msg-reply-box {
    background: rgba(99,102,241,0.1); /* Fundo lil√°s mais suave */
    border-left: 3px solid var(--primary); /* Barra lateral lil√°s */
    padding: 4px 8px; /* REDUZIDO: Menos padding interno para ser mais compacto */
    border-radius: 6px; /* Mantido, mas pode ser ajustado */
    margin-top: 7px; /* REDUZIDO: Pequena margem superior para separar do nome do remetente */
    margin-bottom: 3px; /* REDUZIDO: Pequena margem inferior para separar do texto da mensagem */
    font-size: 0.8rem; /* Mantido, parece ser um bom tamanho para refer√™ncia */
    display: flex; /* Adicionado para permitir flex-direction column nos filhos */
    flex-direction: column;
    box-sizing: border-box; /* Garante que o padding n√£o aumente a largura */
    width: 100%; /* Faz a caixa se ajustar ao conte√∫do */
    max-width: 100%; /* Limita a largura para n√£o esticar demais */
    margin-left: 0; /* Alinha √† esquerda dentro da bolha */
}

.msg-reply-box .reply-name { /* Seletor mais espec√≠fico para o nome dentro da caixa de reply */
    font-weight: 600;
    color: var(--primary);
    font-size: 0.75rem; /* REDUZIDO: Nome dentro da caixa de reply ligeiramente menor */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.2; /* Compacta a altura da linha */
}

.msg-reply-box .reply-text { /* Seletor mais espec√≠fico para o texto dentro da caixa de reply */
    color: var(--muted);
    font-size: 0.7rem; /* REDUZIDO: Texto dentro da caixa de reply bem menor e discreto */
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.4; /* Compacta a altura da linha */
}

/* Estilo para o conte√∫do da mensagem dentro da bolha */
    /* Estilo para o conte√∫do da mensagem dentro da bolha */
   .message-content {
        /* O texto deve ocupar o m√°ximo de espa√ßo, mas sem sobrepor o timestamp. */
        padding-right: 1px; /* Adiciona espa√ßo √† direita para o timestamp n√£o colidir com o texto */
        display: block;
        word-wrap: break-word;
        line-height: 1.4;
        /* Remova qualquer padding-top ou margin-top que possa estar aqui */
    }
/* Estilo para o nome do usu√°rio principal (quem est√° enviando a mensagem) */
.msg b {
    color: #aaa;
    font-weight: 500;
    margin-right: 5px;
    line-height: 1.4; /* Para manter a altura da linha padr√£o do texto da mensagem */
    display: inline-block; /* Garante que o nome ocupe apenas o espa√ßo necess√°rio */
}

/* Gesto de arrastar para a direita */
.msg.swiping {
    transform: translateX(40px); /* Move a mensagem para a direita */
    transition: transform 0.2s ease-out; /* Anima√ß√£o suave */
}

/* Ajustes para a mensagem de admin */
.admin-msg {
    background-color: #5752d4;
    color: #ffffff;
}
.admin-msg .msg-time {
    color: rgba(255, 255, 255, 0.7);
}
.admin-msg b {
    color: #ffffff;
}


    /* NOVO: Estilo para o nome do remetente (elemento separado) */
   .message-sender-name {
        color: var(--muted); /* Use uma cor que se destaque, mas sem ser "chocante" */
        font-weight: 600; /* Mais negrito para o nome */
        font-size: 0.85rem; /* Tamanho ligeiramente menor que o texto principal da mensagem, mas maior que o reply */
        margin-bottom: 4px; /* Espa√ßo entre o nome e o pr√≥ximo elemento (reply ou mensagem) */
        line-height: 1.2; /* Compacta a altura da linha */
        display: block; /* Garante que ocupe a linha inteira */
    }
    
    /* IN√çCIO: NOVO C√ìDIGO - Estilo para Destaque de Mensagem (Ajustado) */
    .msg.highlight {
        background-color: rgba(99, 102, 241, 0.3); /* Um lil√°s um pouco mais forte para "clarear" */
        /* Removido o box-shadow para n√£o ter borda */
        transition: background-color 0.3s ease; /* Transi√ß√£o suave apenas para o background */
    }
    /* FIM: NOVO C√ìDIGO - Estilo para Destaque de Mensagem (Ajustado) */
    

    /* Ajuste para o nome do admin */
.admin-msg .message-sender-name {
    color: #ffffff; /* agora o nome fica branco */
}
    
    
    /* üî¥ IN√çCIO: NOVO C√ìDIGO - Estilos para o bot√£o de scroll */
.scroll-to-bottom-btn {
    position: absolute; /* Para flutuar sobre o chat */
    bottom: 80px; /* Acima do input-area, ajuste conforme necess√°rio */
    right: 20px; /* Canto inferior direito */
    padding: 8px 15px;
    background: rgba(99, 102, 241, 0.9); /* Lil√°s suave com transpar√™ncia */
    color: white;
    border: none;
    border-radius: 20px; /* Borda arredondada */
    font-size: 0.85rem;
    font-weight: 600;
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
    opacity: 0; /* Escondido por padr√£o */
    visibility: hidden; /* Escondido por padr√£o */
    transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.2s ease;
    z-index: 100; /* Garante que fique acima de outros elementos */
    display: flex; /* Para centralizar o √≠cone e texto */
    align-items: center;
    gap: 5px; /* Espa√ßo entre texto e √≠cone (se adicionar) */
}

.scroll-to-bottom-btn.show {
    opacity: 1;
    visibility: visible;
}

.scroll-to-bottom-btn:hover {
    background: rgba(99, 102, 241, 1); /* Um pouco mais opaco no hover */
    transform: translateY(-2px); /* Efeito de "levantar" */
}

.scroll-to-bottom-btn:active {
    transform: translateY(0); /* Efeito de "clique" */
}

/* Ajuste para o layout em PC, onde o chat tem altura definida */
@media (min-width: 1024px) {
   .chat-container {
        position: relative; /* Para o posicionamento absoluto do bot√£o funcionar dentro dele */
    }
   .scroll-to-bottom-btn {
        bottom: 120px; /* Mantenha para desktop */
    }
}
/* üî¥ FIM: NOVO C√ìDIGO */



    /* ESTILO PARA HASHTAGS */
    .hashtag {
            /* === IN√çCIO DO C√ìDIGO DO DEGRAD√ä NO TEXTO === */
    background: linear-gradient(to right, #FF00FF, #FF69B4); /* Degrad√™ do f√∫csia (#FF00FF) para o rosa neon (#FF69B4) */
    -webkit-background-clip: text; /* "Recorta" o fundo para usar apenas no formato do texto */
    -webkit-text-fill-color: transparent; /* Torna a cor do texto transparente para mostrar o fundo */
    
        font-weight: bold;
    }
    
    
        /* IN√çCIO: NOVO C√ìDIGO - Estilos para Limite de Caracteres e Prote√ß√£o de Layout */
    .input-area {
        position: relative; /* Garante que o contador se posicione corretamente */
    }

    .char-count {
        position: absolute;
        bottom: 12px; /* Ajuste para posicionar acima do input */
        right: 80px; /* Ajuste para ficar √† esquerda do bot√£o de enviar */
        font-size: 0.7rem;
        color: var(--muted);
        background-color: transparent; /* Certifica que n√£o tem fundo */
        padding: 2px 5px;
        border-radius: 5px;
        z-index: 5; /* Garante que ele fique por cima do input */
        pointer-events: none; /* N√£o interfere com cliques no input */
        transition: color 0.2s ease; /* Transi√ß√£o de cor suave */
    }

    .char-count.error {
        color: #ef4444; /* Cor vermelha para quando o limite for excedido */
        font-weight: bold;
    }

    /* Prote√ß√£o contra overflow para mensagens muito grandes */
    .messages {
        overflow-wrap: break-word; /* Quebra palavras longas */
        word-break: break-word; /* For√ßa a quebra de palavra para qualquer caractere */
    }

    .msg .message-content {
        max-width: 100%; /* Garante que o conte√∫do n√£o exceda a largura da bolha */
        overflow: hidden; /* Oculta qualquer coisa que tente escapar, embora break-word deve resolver */
    }

    /* Ajuste para o input quando o preview de resposta est√° ativo */
    .reply-preview-container.active + #chatInput {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
        border-top: none;
    }
    /* FIM: NOVO C√ìDIGO */
    
    
    
        /* IN√çCIO: NOVO C√ìDIGO - Estilos para Aviso Anti-Flood */
    .flood-warning {
        width: 100%;
        text-align: center;
        background-color: #ef4444; /* Vermelho vibrante */
        color: white;
        padding: 8px 10px;
        border-radius: 8px;
        margin-bottom: 10px; /* Espa√ßo abaixo do aviso */
        font-size: 0.9rem;
        font-weight: 600;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        /* Garante que apare√ßa acima do input */
        position: relative; 
        z-index: 15; 
        box-sizing: border-box; /* Garante que padding n√£o aumente a largura */
    }

    /* Ajuste para quando o aviso de flood estiver ativo, o input e o contador podem precisar de reposicionamento */
    .input-area.flood-active .char-count {
        bottom: auto; /* Desfaz o posicionamento fixo */
        top: 12px; /* Posiciona no topo do input */
        right: 80px;
    }

    /* Ajuste para o input quando o preview de resposta est√° ativo E flood ativo */
    .input-area.flood-active .reply-preview-container.active + #chatInput {
        border-top-left-radius: 0;
        border-top-right-radius: 0;
        border-top: none;
    }
    /* FIM: NOVO C√ìDIGO - Estilos para Aviso Anti-Flood */
    
    
        /* NOVO ESTILO: Marcador de resposta para o usu√°rio */
    .msg-reply-marker {
        position: absolute; /* Posi√ß√£o absoluta dentro da bolha da mensagem */
        top: 8px; /* Alinhado com o topo, como o nome */
        right: 12px; /* Alinhado √† direita */
        font-size: 0.7rem; /* Tamanho pequeno */
        color: var(--primary); /* Cor lil√°s do tema */
        font-weight: 500; /* Peso da fonte */
        z-index: 2; /* Garante que fique por cima de outros conte√∫dos se houver sobreposi√ß√£o */
    }

    
    
    
</style>

<script>
(function(){
    let userId = localStorage.getItem("bbb_user_id");
    if(!userId){
        userId = "user_" + Math.random().toString(36).substring(2,10);
        localStorage.setItem("bbb_user_id", userId);
    }
    window.BBB_USER_ID = userId;
})();



</script>

</head>
<body>

<header>
    
  
   <!-- BOT√ÉO DO MENU -->
    <button id="menuBtn" class="menu-btn">‚ò∞</button>
    <h>BBB <span>Ao Vivo</span></h>
    <button id="btnAjuda">Ajuda</button>
</header>

<div class="page">

  <div class="left-column">
    <div class="player-container" id="mainPlayer">
      <div id="playerPlaceholder">Escolha uma c√¢mera</div>
      <iframe 
    id="videoPlayer"
    allowfullscreen
    allow="fullscreen; autoplay; encrypted-media; picture-in-picture"
></iframe>
    </div>

    <div class="cam-track">
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb1">C√¢mera 1</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb2">C√¢mera 2</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb3">C√¢mera 3</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb4">C√¢mera 4</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb5">C√¢mera 5</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb6">C√¢mera 6</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb7">C√¢mera 7</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb8">C√¢mera 8</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb9">C√¢mera 9</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbb10">C√¢mera 10</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/bbbmosaico">Mosaico</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb1alternativo">C√¢mera 12</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb2alternativo">C√¢mera 13</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb3alternativo">C√¢mera 14</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb4alternativo">C√¢mera 15</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb5alternativo">C√¢mera 16</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb6alternativo">C√¢mera 17</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb7alternativo">C√¢mera 18</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb8alternativo">C√¢mera 19</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb9alternativo">C√¢mera 20</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb10alternativo">C√¢mera 21</div>
            <div class="cam-card" data-url="https://rdcanais.top/bbb11alternativo">C√¢mera 22</div>
            <div class="cam-card" data-url="https://www2.embedtv.best/globors">Globo</div>
            <div class="cam-card" data-url="https://rdcanais.top/globosp">Globo Alt</div>
            <div class="cam-card" data-url="https://nossoplayeronlinehd.site/tv/globosp">Globo 2</div>
        </div>
    </div>
  
  
   <aside class="chat">
    <div class="chat-header">
        <span class="chat-title">CHAT AO VIVO</span>

        <div class="online-status">
            <span class="dot"></span>
            <span id="onlineBox">0 ONLINE</span>
        </div>
    </div>

<div class="chat-container">
    <div class="messages" id="messageBox"></div>
        <button id="scrollToBottomBtn" class="scroll-to-bottom-btn">
        Mensagens recentes ‚Üì
    </button>
        <div class="input-area">
          <!-- IN√çCIO: NOVO C√ìDIGO - Aviso Anti-Flood -->
        <div id="floodWarning" class="flood-warning" style="display: none;">
            Voc√™ enviou mensagens muito r√°pido. Aguarde <span id="floodCountdown">60</span> segundos.
        </div>
        <!-- FIM: NOVO C√ìDIGO -->
    <div class="reply-preview-container" id="replyPreviewContainer">
    <div class="reply-bar"></div>
    <div class="reply-content">
        <span id="replyPreviewName" class="reply-name"></span>
        <span id="replyPreviewText" class="reply-text"></span>
    </div>
    <button id="cancelReplyBtn" class="cancel-reply-btn">‚úï</button>
</div>

        <input type="text" id="chatInput" placeholder="Digite sua mensagem...">
        <!-- IN√çCIO: NOVO C√ìDIGO - Contador de Caracteres -->
            <div id="charCount" class="char-count">0 / 200</div>
            <!-- FIM: NOVO C√ìDIGO -->
        <button id="sendBtn">‚û§</button>
    </div>
</div>
      
      
<!-- MODAL AJUDA -->
<div class="modal" id="helpModal">
    <div class="modal-box">
        <h2>Central de Ajuda</h2>

 <div class="help-card">
  <h3 class="help-title">Algumas c√¢meras n√£o funcionam</h3>

  <div class="help-content">
    <p>
      <strong>Por que isso acontece?</strong><br>
      Algumas operadoras bloqueiam seu acesso a esse tipo de transmiss√£o, pelo DNS da operadora.
      
    </p>

    <p>
      <strong>Como resolver:</strong>
    </p>

    <p>
      1Ô∏è‚É£ Baixe o aplicativo <strong>1.1.1.1 (WARP)</strong> na Play Store.<br><br>
      2Ô∏è‚É£ Abra o aplicativo e ative a conex√£o (espere mostrar que est√° conectado).<br><br>
      3Ô∏è‚É£ Volte para este site e atualize a p√°gina.<br><br>
      ‚úÖ Pronto! Algumas c√¢meras que n√£o funcionavam devem voltar normalmente.
    </p>
  </div>
</div>

<div class="help-card">
  <h3 class="help-title">A transmiss√£o fica pausada ou aparecem an√∫ncios</h3>

  <div class="help-content">
    <p>
      <strong>Motivo:</strong><br>
      Algumas transmiss√µes podem iniciar pausadas ou exibir an√∫ncios.
      Esses an√∫ncios ajudam a manter a transmiss√£o ao vivo funcionando 24 horas.
    </p>

    <p>
      <strong>Solu√ß√£o:</strong><br>
      ‚Ä¢ Se voc√™ foi direcionado para outra p√°gina, volte ao site e clique no play novamente (repita esse processo at√© funcionar).<br>
      ‚Ä¢ Caso a transmiss√£o continue pausada, atualize a p√°gina.
    </p>
  </div>
</div>

<div class="help-card">
  <h3 class="help-title">Algumas c√¢meras travam ou demoram para carregar</h3>

  <div class="help-content">
    <p>
      <strong>Motivo:</strong><br>
      Isso pode acontecer por instabilidade no servidor da transmiss√£o,
      manuten√ß√£o tempor√°ria ou conex√£o de internet lenta.
    </p>

    <p>
      <strong>Solu√ß√£o:</strong><br>
      ‚Ä¢ Aguarde alguns instantes e tente novamente.<br>
      ‚Ä¢ Verifique sua conex√£o com a internet.<br>
      ‚Ä¢ Se necess√°rio, atualize a p√°gina.<br><br>
      Na maioria dos casos, a transmiss√£o volta ao normal em poucos segundos.
    </p>
  </div>
</div>
      

        <button class="close-help" id="closeHelp">Entendi</button>
    </div>
</div>
        
                  <!-- MENU LATERAL -->
<div class="side-menu" id="sideMenu">
    <div class="side-menu-content">

        <!-- PERFIL -->
        <div class="menu-profile">
            <div class="profile-icon">üë§</div>
            <div class="profile-name" id="menuUsername">Usu√°rio</div>
        </div>

        <!-- OP√á√ïES -->
        <nav class="menu-links">
            <button id="menuSobre">Sobre</button>
            <button id="menuSuporte">Suporte</button>
        </nav>

    </div>
</div>
      
      
    
    <div class="modal" id="sobreModal">
  <div class="modal-box">
    <h2>Sobre o projeto</h2>

    <div class="help-card active">
      <p>
        O <strong>BBB Ao Vivo</strong> √© um projeto independente criado
        para facilitar o acesso √†s c√¢meras ao vivo em um √∫nico lugar totalmente de gra√ßa!
        Com interface moderna, leve e responsiva.
      </p>
      <p>
        As transmiss√µes s√£o incorporadas de fontes p√∫blicas, encontradas pela internet.
      </p>
    </div>

    <button class="close-help" onclick="fecharModalGenerico('sobreModal')">
      Fechar
    </button>
  </div>
</div>
    
    <div class="modal" id="suporteModal">
  <div class="modal-box">
    <h2>Suporte</h2>

    <div class="help-card active">
      <p>
        Est√° com problemas nas transmiss√µes ou encontrou algum erro?
      </p>

      <p>
        Entre em contato conosco.
      </p>

      <p style="color: var(--primary); font-weight: 600;">
        ‚úÜ WhatsApp: (91) 99251-1446
         ‚å≤Telegram: t.me/maicon_dev1
      </p>
    </div>

    <button class="close-help" onclick="fecharModalGenerico('suporteModal')">
      Fechar
    </button>
  </div>
</div>
      

<!-- MODAL NOME -->
<div class="name-modal" id="nameModal">
    <div class="name-box">
        <h2>Bem-vindo üëã</h2>
        <p>Escolha um nome para participar do chat</p>
        <input type="text" id="nameInput" placeholder="Seu nome">
        <!-- IN√çCIO: NOVO C√ìDIGO - Mensagem de Erro do Nome -->
            <p id="nameError" class="name-error" style="display: none;">O nome deve ter no m√°ximo 25 caracteres.</p>
            <!-- FIM: NOVO C√ìDIGO -->
        <button id="enterNameBtn">Entrar</button>
    </div>
</div>

<div class="modal" id="modal">
    <div class="modalContent">
        <div id="modalImg"></div>
        <h2 id="modalTitle"></h2>
        <div id="modalText" style="margin-bottom:10px;"></div>
        <button id="fecharModal">Fechar</button>
    </div>
</div>
      

      
      

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
import { 
  getDatabase, 
  ref, 
  onChildAdded, 
  set, 
  onDisconnect, 
  onValue, 
  push, 
  remove,
  query,
  orderByChild,
    get
} from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";
    
    const firebaseConfig = {
      apiKey: "AIzaSyBfwC-5l8fPCvcgrwao9pG7gj9TmOuvLcU", // ESTAS S√ÉO AS NOVAS INFOS
      authDomain: "bbb-ao-vivo2.firebaseapp.com",
      databaseURL: "https://bbb-ao-vivo2-default-rtdb.firebaseio.com",
      projectId: "bbb-ao-vivo2",
      storageBucket: "bbb-ao-vivo2.firebasestorage.app",
      messagingSenderId: "172632221080",
      appId: "1:172632221080:web:7e3659ee27e0cea434f7ed"
    };

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* MODAL DE AVISO */
const modal = document.getElementById("modal");
const modalText = document.getElementById("modalText");
const modalImg = document.getElementById("modalImg");
const fecharBtn = document.getElementById("fecharModal");

fecharBtn.onclick = () => {
    if(modal.dataset.key) {
        localStorage.setItem(`fechado_${modal.dataset.key}`, "true");
    }
    modal.classList.remove("show");
    modal.classList.add("hide");

    // remove display ap√≥s a anima√ß√£o
    setTimeout(() => {
        modal.style.display = "none";
        modal.classList.remove("hide");
    }, 200); // tempo igual ao da anima√ß√£o
};
      
      

function mostrarModal(key, titulo, texto, imagem){
    if(localStorage.getItem(`fechado_${key}`) === "true") return false;
    modal.dataset.key = key;
    document.getElementById("modalTitle").textContent = titulo || "Aviso";
    modalText.textContent = texto || "";
    modalImg.innerHTML = imagem ? `<img src="${imagem}">` : "";
    modal.style.display = "flex";
}

function iniciarSistemaAvisos() {
    onChildAdded(ref(db, "avisos"), snapshot => {
        const data = snapshot.val();
        if(!data) return;
        mostrarModal(snapshot.key, data.titulo, data.texto, data.imagem);
    });
}

/* CAMERAS */
const iframe = document.getElementById("videoPlayer");
const camCards = document.querySelectorAll(".cam-card");
const playerBox = document.getElementById("mainPlayer");
const placeholder = document.getElementById("playerPlaceholder");

// Estado inicial
iframe.src = "";
placeholder.style.display = "flex";
playerBox.classList.remove("loading");

// Clique nas c√¢meras
camCards.forEach(card => {
    card.addEventListener("click", () => {

        // Remove ativo de todas
        camCards.forEach(c => c.classList.remove("active"));
        card.classList.add("active");

        // Esconde "Escolha uma c√¢mera"
        placeholder.style.display = "none";

        // Mostra "Carregando c√¢mera..."
        playerBox.classList.add("loading");

        // Troca o iframe
        iframe.src = card.dataset.url;

        // Remove loading ap√≥s carregar
        setTimeout(() => {
            playerBox.classList.remove("loading");
        }, 2400);
    });
});

      


/* ONLINE */
const onlineBox = document.getElementById("onlineBox");
let UID = localStorage.getItem("bbb_uid");
if(!UID) {
    UID = 'uid_' + Math.random().toString(36).substr(2, 9) + Date.now();
    localStorage.setItem("bbb_uid", UID);
}
const userRef = ref(db, "online/" + UID);
set(userRef, true);
onDisconnect(userRef).remove();
onValue(ref(db, "online"), snapshot => {
    const users = snapshot.val();
    const count = users ? Object.keys(users).length : 0;
    onlineBox.textContent = `${count} ONLINE`;
});

/* REGISTRO DE USU√ÅRIO */
set(ref(db, "usuarios/" + UID), {
    online: true,
    entrouEm: new Date().toLocaleString()
});
window.addEventListener("beforeunload", () => remove(ref(db, "usuarios/" + UID)));

/* BAN AUTOM√ÅTICO */
const palavrasProibidas = ["script", "iframe", "onerror", "onload", "eval", "document.",
    "javascript:", "window.", "alert(", "confirm(", "prompt(", "src=", "href=", "location.",
    "fetch(", "XMLHttpRequest", "localStorage", "sessionStorage", "innerHTML",
    "outerHTML", "setAttribute(", "getAttribute(", "replace(", "appendChild", "removeChild",
    "insertBefore", "eval(", "Function(", "while(", "for(", "do{", "document.write"
];
function mensagemSuspeita(texto) {
    texto = texto.toLowerCase();
    return palavrasProibidas.some(p => texto.includes(p));
}

function banirAutomatico(motivo) {
    set(ref(db, "banidos/" + UID), { motivo: motivo, data: new Date().toLocaleString() });
    push(ref(db, "logs"), { uid: UID, acao: "BAN AUTOM√ÅTICO", motivo: motivo, data: new Date().toLocaleString() });
    alert("üö´ Voc√™ foi bloqueado por ter usado palavras proibidas!");
}

onValue(ref(db, "banidos/" + UID), snap => {
    if(snap.exists()){
        document.body.innerHTML = `
        <div style="
            height:100vh;
            display:flex;
            align-items:center;
            justify-content:center;
            background:#000;
            color:#fff;
            text-align:center;">
            <div>
                <h2>üö´ Acesso bloqueado</h2>
                <p>Voc√™ foi banido do sistema por ter violado as regras do site.</p>
            </div>
        </div>`;
    }
});

    /* ------------------- MODAL NOME ------------------- */
    let chatUsername = localStorage.getItem('chatName');
    const nameModal = document.getElementById('nameModal');
    const nameInput = document.getElementById('nameInput'); // Obter refer√™ncia aqui
    const nameError = document.getElementById('nameError'); // Obter refer√™ncia aqui

    // IN√çCIO: NOVO C√ìDIGO - Fun√ß√µes de Limpeza e Valida√ß√£o do Nome
    function cleanAndValidateName(inputName) {
        // 1. Remover espa√ßos no in√≠cio e no final
        let cleanedName = inputName.trim();

        // 2. Reduzir m√∫ltiplos espa√ßos internos para apenas um
        cleanedName = cleanedName.replace(/\s+/g, ' ');

        // 3. Proteger contra HTML e scripts: tratar como texto comum
        // Cria um elemento tempor√°rio para HTML e pega seu texto
        const div = document.createElement('div');
        div.appendChild(document.createTextNode(cleanedName));
        cleanedName = div.innerHTML; // Isso converte < para &lt; e > para &gt;

        return cleanedName;
    }

    function validateNameLength(name) {
        const MIN_CHARS = 1;
        const MAX_CHARS = 25;
        if (name.length < MIN_CHARS || name.length > MAX_CHARS) {
            return false;
        }
        return true;
    }
    // FIM: NOVO C√ìDIGO - Fun√ß√µes de Limpeza e Valida√ß√£o do Nome

    if(!chatUsername){
        nameModal.style.display = 'flex';
        // Adiciona listener para o input do nome para mostrar a mensagem de erro em tempo real
        nameInput.addEventListener('input', () => {
            const currentName = nameInput.value;
            // Apenas verifica o limite m√°ximo para feedback visual
            if (currentName.length > 25) {
                nameError.style.display = 'block';
                // Opcional: Cortar o texto no input para impedir mais digita√ß√£o
                // nameInput.value = currentName.substring(0, 35);
            } else {
                nameError.style.display = 'none';
            }
        });
    } else {
        nameModal.style.display = 'none';
        iniciarSistemaAvisos();
    }

    function saveName() {
        const rawName = nameInput.value;
        const processedName = cleanAndValidateName(rawName);

        // Valida√ß√£o final do nome processado
        if (!validateNameLength(processedName)) {
            nameError.textContent = 'O nome deve ter entre 1 e 25 caracteres.';
            nameError.style.display = 'block';
            return; // Impede que o nome seja salvo
        }

        // Se chegou aqui, o nome √© v√°lido e limpo
        localStorage.setItem('chatName', processedName);
        chatUsername = processedName;
        
        document.getElementById("menuUsername").textContent = processedName; // Atualiza o menu lateral
        
        nameModal.style.display = 'none';
        iniciarSistemaAvisos();
    }    
        
    // Bot√£o Entrar
    document.getElementById('enterNameBtn').addEventListener('click', saveName);

    // Enter no input do nome
    document.getElementById('nameInput').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') saveName();
    });

/* ------------------- CHAT ------------------- */
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const messageBox = document.getElementById('messageBox');
// --- VARI√ÅVEIS E FUN√á√ïES GLOBAIS PARA O SISTEMA DE REPLY ---
let replyingTo = null; // Armazena temporariamente os dados da mensagem sendo respondida
    // IN√çCIO: NOVO C√ìDIGO - Vari√°veis para Limite de Caracteres
    const MAX_CHARS = 200;
    const charCountElement = document.getElementById('charCount');
    // FIM: NOVO C√ìDIGO
    
        // NOVO: Armazena os IDs das mensagens que este usu√°rio enviou
    let mySentMessageIds = JSON.parse(localStorage.getItem('mySentMessageIds')) || [];
    
        // IN√çCIO: NOVO C√ìDIGO - Vari√°veis e L√≥gica Anti-Flood
    const FLOOD_MESSAGE_LIMIT = 3; // Quantidade de mensagens para ativar o flood
    const FLOOD_TIME_WINDOW = 8000; // 5 segundos em milissegundos
    const FLOOD_BLOCK_DURATION = 120; // 30 segundos de bloqueio
        // IN√çCIO: NOVO C√ìDIGO - Chaves para localStorage
    const LOCAL_STORAGE_FLOOD_START_KEY = 'floodStartTime';
    const LOCAL_STORAGE_FLOOD_END_KEY = 'floodEndTime';
    // FIM: NOVO C√ìDIGO

    let messagesSentTimestamps = []; // Armazena os timestamps das √∫ltimas mensagens enviadas
    let isFlooded = false; // Flag para indicar se o usu√°rio est√° bloqueado
    let floodTimeoutId = null; // ID do timeout para liberar o bloqueio
    let floodCountdownInterval = null; // ID do intervalo para o contador regressivo

    const floodWarningElement = document.getElementById('floodWarning');
    const floodCountdownElement = document.getElementById('floodCountdown');

    function checkFlood() {
        const now = Date.now();
        // Remove timestamps antigos (fora da janela de 5 segundos)
        messagesSentTimestamps = messagesSentTimestamps.filter(timestamp => now - timestamp < FLOOD_TIME_WINDOW);

        if (messagesSentTimestamps.length >= FLOOD_MESSAGE_LIMIT) {
            startFloodProtection();
            return true; // Usu√°rio foi detectado como floodando
        }
        return false; // N√£o est√° floodando
    }

    function startFloodProtection() {
        if (isFlooded) return; // J√° est√° bloqueado, n√£o faz nada

        const now = Date.now();
        const blockEndTime = now + (FLOOD_BLOCK_DURATION * 1000); // Calcula o tempo de fim do bloqueio

        // IN√çCIO: NOVO C√ìDIGO - Salvar estado no localStorage
        localStorage.setItem(LOCAL_STORAGE_FLOOD_START_KEY, now.toString());
        localStorage.setItem(LOCAL_STORAGE_FLOOD_END_KEY, blockEndTime.toString());
        // FIM: NOVO C√ìDIGO

        isFlooded = true;
        sendBtn.disabled = true; // Desabilita o bot√£o
        chatInput.disabled = true; // Desabilita o input
        floodWarningElement.style.display = 'block'; // Mostra o aviso
        document.querySelector('.input-area').classList.add('flood-active'); // Adiciona classe para ajuste de layout

        // O countdown agora √© baseado no tempo restante at√© blockEndTime
        let countdown = Math.ceil((blockEndTime - now) / 1000);
        floodCountdownElement.textContent = countdown; // Exibe o tempo inicial

        // Limpa intervalos anteriores para evitar duplicidade
        if (floodCountdownInterval) clearInterval(floodCountdownInterval);
        if (floodTimeoutId) clearTimeout(floodTimeoutId);

        floodCountdownInterval = setInterval(() => {
            countdown--;
            floodCountdownElement.textContent = countdown;
            if (countdown <= 0) {
                clearInterval(floodCountdownInterval);
                endFloodProtection();
            }
        }, 1000); // Atualiza a cada segundo

        // Define um timeout para liberar o bloqueio (garantia)
        floodTimeoutId = setTimeout(() => {
            endFloodProtection();
        }, countdown * 1000 + 500); // Pequeno buffer para garantir que n√£o haja atrasos
    }

        function endFloodProtection() {
        isFlooded = false;
        clearTimeout(floodTimeoutId);
        clearInterval(floodCountdownInterval);

        // IN√çCIO: NOVO C√ìDIGO - Remover estado do localStorage
        localStorage.removeItem(LOCAL_STORAGE_FLOOD_START_KEY);
        localStorage.removeItem(LOCAL_STORAGE_FLOOD_END_KEY);
        // FIM: NOVO C√ìDIGO

        floodWarningElement.style.display = 'none'; // Esconde o aviso
        document.querySelector('.input-area').classList.remove('flood-active'); // Remove classe de ajuste de layout

        // Reabilita o bot√£o e o input. updateCharCountAndButton j√° lida com outras condi√ß√µes.
        updateCharCountAndButton();
        chatInput.disabled = false; // Garante que o input seja reativado.
    }
    // FIM: NOVO C√ìDIGO - Vari√°veis e L√≥gica Anti-Flood
    
        // IN√çCIO: NOVO C√ìDIGO - Fun√ß√£o para inicializar prote√ß√£o contra flood ao carregar a p√°gina
    function initializeFloodProtection() {
        const floodEndTime = localStorage.getItem(LOCAL_STORAGE_FLOOD_END_KEY);
        const now = Date.now();

        if (floodEndTime && parseInt(floodEndTime) > now) {
            // Se houver um floodEndTime salvo e ele ainda n√£o expirou
            isFlooded = true;
            sendBtn.disabled = true;
            chatInput.disabled = true;
            floodWarningElement.style.display = 'block';
            document.querySelector('.input-area').classList.add('flood-active');

            let countdown = Math.ceil((parseInt(floodEndTime) - now) / 1000);
            floodCountdownElement.textContent = countdown;

            // Limpa intervalos anteriores para evitar duplicidade
            if (floodCountdownInterval) clearInterval(floodCountdownInterval);
            if (floodTimeoutId) clearTimeout(floodTimeoutId);

            floodCountdownInterval = setInterval(() => {
                countdown--;
                floodCountdownElement.textContent = countdown;
                if (countdown <= 0) {
                    clearInterval(floodCountdownInterval);
                    endFloodProtection();
                }
            }, 1000);

            floodTimeoutId = setTimeout(() => {
                endFloodProtection();
            }, countdown * 1000 + 500);

        } else {
            // Se n√£o h√° bloqueio salvo ou se ele j√° expirou, garante que tudo esteja limpo
            endFloodProtection();
        }
    }
    // FIM: NOVO C√ìDIGO
    
    
const replyPreviewContainer = document.getElementById('replyPreviewContainer');
const replyPreviewName = document.getElementById('replyPreviewName');
const replyPreviewText = document.getElementById('replyPreviewText');
const cancelReplyBtn = document.getElementById('cancelReplyBtn');
    // ... suas vari√°veis e fun√ß√µes existentes ...

    // --- FUN√á√ÉO PARA FORMATAR A MENSAGEM COM HASHTAGS ---
    function formatMessageWithHashtags(message) {
        // Express√£o regular para encontrar # seguido de caracteres que n√£o s√£o espa√ßo nem outros s√≠mbolos
        // A hashtag termina com um espa√ßo ou um s√≠mbolo (exceto #)
        const hashtagRegex = /(#[\p{L}\p{N}_-]+)/gu; // Suporta caracteres Unicode, n√∫meros e underscore

        // Substitui a hashtag encontrada por ela mesma envolvida em um span com a classe 'hashtag'
        return message.replace(hashtagRegex, '<span class="hashtag">$&</span>');
    }

    // --- FUN√á√ÉO PARA ATUALIZAR O PREVIEW DA RESPOSTA COM HASHTAGS ---
    function updatePreviewWithHashtags(message) {
        // Esta fun√ß√£o √© quase igual √† de cima, mas o regex √© levemente ajustado se necess√°rio
        // E ela retorna o texto para ser atribu√≠do via innerHTML
        const hashtagRegex = /(#[\p{L}\p{N}_-]+)/gu;
        return message.replace(hashtagRegex, '<span class="hashtag">$&</span>');
    }

    // ... suas fun√ß√µes sendMsg, setReply, cancelReply, etc. ...

function setReply(msgData, msgId) {
    // console.log("Configurando reply para:", msgData); // Mantenha para debug se quiser
    replyingTo = {
        id: msgId,
        user: msgData.user,
        message: msgData.message
    };
    replyPreviewName.textContent = msgData.user;
    const previewMessage = msgData.message.substring(0, 50) + (msgData.message.length > 50 ? '...' : '');
    replyPreviewText.innerHTML = updatePreviewWithHashtags(previewMessage);

    // --- IN√çCIO DA MODIFICA√á√ÉO CORRIGIDA AQUI ---
    // Primeiro, garanta que ele esteja como flex e vis√≠vel antes de aplicar a classe 'active'
    replyPreviewContainer.style.display = 'flex';
    // √â importante for√ßar o navegador a renderizar esta mudan√ßa ANTES de adicionar a classe 'active'
    // Um pequeno timeout (0ms) ou uma leitura de propriedade que force o reflow pode ajudar.
    // Usaremos requestAnimationFrame para garantir que a mudan√ßa de display seja processada.
    requestAnimationFrame(() => {
        replyPreviewContainer.classList.add('active'); // Adiciona a classe 'active' para iniciar o fade-in
    });
    // --- FIM DA MODIFICA√á√ÉO CORRIGIDA ---

    chatInput.focus();
    messageBox.scrollTop = messageBox.scrollHeight;
}
    

    function cancelReply() {
        replyingTo = null;

        // --- IN√çCIO DA MODIFICA√á√ÉO AQUI ---
        replyPreviewContainer.classList.remove('active'); // Remove a classe 'active' para iniciar o fade-out

        // Adiciona um listener para quando a transi√ß√£o de opacidade terminar
        // Usamos { once: true } para que o listener seja executado apenas uma vez
        replyPreviewContainer.addEventListener('transitionend', function handler(event) {
            // Verifique se a transi√ß√£o que terminou √© a da 'opacity'
            if (event.propertyName === 'opacity' && !replyPreviewContainer.classList.contains('active')) {
                replyPreviewContainer.style.display = 'none'; // Finalmente esconde o elemento totalmente
            }
            // Remove o pr√≥prio listener para evitar execu√ß√µes desnecess√°rias
            replyPreviewContainer.removeEventListener('transitionend', handler);
        }, { once: true });
        // --- FIM DA MODIFICA√á√ÉO ---
    }

cancelReplyBtn.addEventListener('click', cancelReply);

// Fun√ß√£o para enviar mensagens
function sendMsg() {
  if (isFlooded) { // Se j√° estiver bloqueado, simplesmente retorna
            return;
        }
  
  
    const username = localStorage.getItem('chatName');
    if(!username) {
        alert('Escolha um nome antes de enviar mensagens!');
        return;
    }

    const text = chatInput.value.trim();
    if(!text) return;
    
    // IN√çCIO: NOVO C√ìDIGO - L√≥gica de Limite e Valida√ß√£o
        // 1. Impedir envio de mensagem vazia
        if (text.trim() === '') { // Usamos .trim() para verificar se √© *apenas* espa√ßos
            // N√£o precisa de alerta, o bot√£o j√° estar√° desabilitado visualmente
            return; 
        }
        // 2. Cortar texto se for maior que o limite
        if (text.length > MAX_CHARS) {
            text = text.substring(0, MAX_CHARS);
            // Opcional: alertar o usu√°rio que a mensagem foi cortada
            // alert(`Sua mensagem foi cortada para ${MAX_CHARS} caracteres.`);
        }
        // FIM: NOVO C√ìDIGO
  
    // üî¥ Ban autom√°tico
    if(mensagemSuspeita(text)){
        banirAutomatico("Mensagem suspeita detectada");
        return; // n√£o envia a mensagem
    }

messagesSentTimestamps.push(Date.now()); 
        if (checkFlood()) { // Verifica se este envio ativou o modo flood
            return; // Se ativou o flood, esta mensagem n√£o ser√° enviada
        }


    const messageData = {
        user: username,
        userId: UID,
        message: text,
        timestamp: Date.now()
    };

    // --- ADICIONE ESTA L√ìGICA PARA replyTo ---
    // --- ADICIONE ESTA L√ìGICA PARA replyTo ---
    if (replyingTo) {
        messageData.replyTo = {
            user: replyingTo.user,
            message: replyingTo.message,
            originalId: replyingTo.id // <-- IN√çCIO: NOVO C√ìDIGO - Salva o ID da mensagem original no Firebase
        }; //
        cancelReply(); // Limpa o preview ap√≥s o envio
    }
    // --- FIM DA L√ìGICA replyTo ---

        // Envia a mensagem para o Firebase e captura a refer√™ncia para pegar o ID gerado
    const newMessageRef = push(ref(db, "chat"), messageData);
    mySentMessageIds.push(newMessageRef.key); // Adiciona o ID da mensagem √† sua lista
    localStorage.setItem('mySentMessageIds', JSON.stringify(mySentMessageIds)); // Salva no localStorage

    chatInput.value = '';
}

    // IN√çCIO: NOVO C√ìDIGO - Eventos para o Input do Chat (com limite e contador)
        function updateCharCountAndButton() {
        const currentLength = chatInput.value.length;
        charCountElement.textContent = `${currentLength} / ${MAX_CHARS}`;

        // IN√çCIO: NOVO C√ìDIGO - L√≥gica Anti-Flood na atualiza√ß√£o do bot√£o
        // Primeiro, verifica se o usu√°rio est√° floodado
        if (isFlooded) {
            sendBtn.disabled = true;
            chatInput.disabled = true; // Desabilita o input
            sendBtn.style.opacity = '0.5';
            sendBtn.style.cursor = 'not-allowed';
            return; // Sai da fun√ß√£o, pois o estado de flood tem preced√™ncia
        }
        // FIM: NOVO C√ìDIGO

        // Habilita o input, pois n√£o est√° floodado (se estava desabilitado por flood)
        chatInput.disabled = false;

        // L√≥gica existente de limite de caracteres e mensagem vazia
        if (currentLength > MAX_CHARS || chatInput.value.trim() === '') {
            charCountElement.classList.toggle('error', currentLength > MAX_CHARS); // Alterna a classe 'error'
            sendBtn.disabled = true;
            sendBtn.style.opacity = '0.5';
            sendBtn.style.cursor = 'not-allowed';
        } else {
            charCountElement.classList.remove('error');
            sendBtn.disabled = false;
            sendBtn.style.opacity = '1';
            sendBtn.style.cursor = 'pointer';
        }
    }

    // Inicializa o contador e o estado do bot√£o
    updateCharCountAndButton();

    // Adiciona listener para qualquer altera√ß√£o no input (digitar, colar, cortar)
    chatInput.addEventListener('input', updateCharCountAndButton);

    // Eventos para envio de mensagens
    sendBtn.addEventListener('click', () => {
        // Verifica o estado final antes de tentar enviar
        if (!sendBtn.disabled) {
            sendMsg();
            // Ap√≥s enviar, reseta o contador e o estado do bot√£o para a mensagem vazia
            chatInput.value = ''; // Limpa o input
            updateCharCountAndButton(); // Atualiza o contador para 0/300 e desabilita o bot√£o
        }
    });
    chatInput.addEventListener('keypress', (e) => {
          // IN√çCIO: NOVO C√ìDIGO - Chamada inicial da prote√ß√£o anti-flood
    initializeFloodProtection();
    // FIM: NOVO C√ìDIGO
        if(e.key === 'Enter' && !sendBtn.disabled) { // S√≥ envia se n√£o estiver desabilitado
            sendMsg();
            // Ap√≥s enviar, reseta o contador e o estado do bot√£o para a mensagem vazia
            // O evento keypress acontece antes do 'input', ent√£o precisamos limpar aqui
            // e chamar o update para refletir a mensagem vazia
            setTimeout(() => { // Pequeno delay para garantir que o input.value foi resetado
                chatInput.value = '';
                updateCharCountAndButton();
            }, 0);
        }
    });
    // FIM: NOVO C√ìDIGO
    
    


// ADICIONE ESTE BLOCO DE C√ìDIGO AP√ìS AS FUN√á√ïES ACIMA E ANTES DA onChildAdded
let touchStartX = 0;
let touchEndX = 0;
const SWIPE_THRESHOLD = 50; // Pixels para detectar o arrastar

messageBox.addEventListener('touchstart', (e) => {
    // console.log("touchstart", e.target); // Debug
    const msgElement = e.target.closest('.msg');
    if (msgElement) {
        touchStartX = e.touches[0].clientX;
        msgElement.dataset.swiping = 'true'; // Sinaliza que o swipe come√ßou neste elemento
        // Limpa a transi√ß√£o de outras mensagens, se houver
        document.querySelectorAll('.msg.swiping').forEach(el => {
            if (el!== msgElement) el.classList.remove('swiping');
            el.style.transform = '';
        });
    }
}, { passive: true });

messageBox.addEventListener('touchmove', (e) => {
    const msgElement = e.target.closest('.msg');
    if (msgElement && msgElement.dataset.swiping === 'true') {
        touchEndX = e.touches[0].clientX;
        const deltaX = touchEndX - touchStartX;
        if (deltaX > 0) { // Somente para arrastar para a direita
            msgElement.style.transform = `translateX(${Math.min(deltaX, SWIPE_THRESHOLD * 1.5)}px)`;
        } else {
            msgElement.style.transform = ''; // Reseta se arrastar para a esquerda
        }
    }
}, { passive: true });

messageBox.addEventListener('touchend', (e) => {
    const msgElement = e.target.closest('.msg');
    if (msgElement && msgElement.dataset.swiping === 'true') {
        const deltaX = touchEndX - touchStartX;
        
        if (deltaX > SWIPE_THRESHOLD) {
            // Detectado arrastar para a direita
                // Detectado arrastar para a direita
    const msgId = msgElement.dataset.messageId; // Recupera o ID da mensagem
    const user = msgElement.querySelector('.message-sender-name').textContent.replace('‚ú¶', '').replace('[ADMIN]:', '').trim(); // PEGA O NOME DO NOVO ELEMENTO
    let messageText = msgElement.querySelector('.message-content').textContent.trim(); // PEGA APENAS O CONTE√öDO PURO DA MENSAGEM
            
            // Se for mensagem de admin, remove o prefixo "‚ú¶ [ADMIN]:"
            if (msgElement.classList.contains('admin-msg')) {
                messageText = messageText.replace('‚ú¶ [ADMIN]:', '').trim();
            }

            // Se for uma mensagem de reply, pegamos o texto da mensagem respondida (se existir)
            const replyTextBox = msgElement.querySelector('.msg-reply-box.reply-text');
            if (replyTextBox) {
                messageText = replyTextBox.textContent.trim();
            } else {
                // Sen√£o, pegamos o texto da mensagem normal, limitando para o preview
                const fullText = msgElement.querySelector('.message-content').textContent;
                messageText = fullText.replace(new RegExp(`^${user}:`), '').trim(); // Remove o nome do remetente do texto
            }
            
            setReply({ user: user, message: messageText }, msgId);

        }
        
        msgElement.classList.remove('swiping');
        msgElement.style.transform = ''; // Reseta a posi√ß√£o visual
        delete msgElement.dataset.swiping; // Limpa o sinalizador
        touchStartX = 0;
        touchEndX = 0;
    }
});

// Implementa√ß√£o para Desktop (arrastar com o mouse)
let isDragging = false;
let startX = 0;
let currentMsgElement = null;

messageBox.addEventListener('mousedown', (e) => {
    const msgElement = e.target.closest('.msg');
    if (msgElement) {
        isDragging = true;
        startX = e.clientX;
        currentMsgElement = msgElement;
        // Limpa a transi√ß√£o de outras mensagens, se houver
        document.querySelectorAll('.msg.swiping').forEach(el => {
            if (el!== currentMsgElement) el.classList.remove('swiping');
            el.style.transform = '';
        });
        currentMsgElement.classList.add('swiping'); // Adiciona classe para transi√ß√£o
    }
});

messageBox.addEventListener('mousemove', (e) => {
    if (isDragging && currentMsgElement) {
        const deltaX = e.clientX - startX;
        if (deltaX > 0) {
            currentMsgElement.style.transform = `translateX(${Math.min(deltaX, SWIPE_THRESHOLD * 1.5)}px)`;
        } else {
            currentMsgElement.style.transform = '';
        }
    }
});

messageBox.addEventListener('mouseup', (e) => {
    if (isDragging && currentMsgElement) {
        const deltaX = e.clientX - startX;
        if (deltaX > SWIPE_THRESHOLD) {
            // Detectado arrastar para a direita
                // Detectado arrastar para a direita
    const msgId = currentMsgElement.dataset.messageId;
    const user = currentMsgElement.querySelector('.message-sender-name').textContent.replace('‚ú¶', '').replace('[ADMIN]:', '').trim(); // PEGA O NOME DO NOVO ELEMENTO
    let messageText = currentMsgElement.querySelector('.message-content').textContent.trim(); // PEGA APENAS O CONTE√öDO PURO DA MENSAGEM

            if (currentMsgElement.classList.contains('admin-msg')) {
                messageText = messageText.replace('‚ú¶ [ADMIN]:', '').trim();
            }

            const replyTextBox = currentMsgElement.querySelector('.msg-reply-box.reply-text');
            if (replyTextBox) {
                messageText = replyTextBox.textContent.trim();
            } else {
                 const fullText = currentMsgElement.querySelector('.message-content').textContent;
                 messageText = fullText.replace(new RegExp(`^${user}:`), '').trim();
            }
            
            setReply({ user: user, message: messageText }, msgId);
        }
        
        currentMsgElement.classList.remove('swiping');
        currentMsgElement.style.transform = ''; // Reseta a posi√ß√£o visual
        isDragging = false;
        currentMsgElement = null;
    }
});

messageBox.addEventListener('mouseleave', (e) => {
    if (isDragging && currentMsgElement) {
        currentMsgElement.classList.remove('swiping');
        currentMsgElement.style.transform = '';
        isDragging = false;
        currentMsgElement = null;
    }
});

// ---------- RECEBER MENSAGENS ----------
onChildAdded(ref(db, "chat"), snapshot => {
    const data = snapshot.val();
    if (!data) return;

    const msg = document.createElement('div');
    msg.className = 'msg';
    msg.dataset.messageId = snapshot.key; // Armazena o ID da mensagem para o reply
    
        msg.dataset.messageId = snapshot.key; // Armazena o ID da mensagem para o reply
    msg.dataset.authorId = data.userId; // Armazena o ID do autor da mensagem ATUAL

    // --- C√ìDIGO CORRIGIDO PARA O MARCADOR "@ respondeu sua mensagem" ---
    // Condi√ß√£o 1: Esta mensagem ATUAL est√° respondendo a algu√©m (tem 'replyTo')
    // Condi√ß√£o 2: A mensagem que est√° sendo respondida (originalId) foi enviada por MIM (window.BBB_USER_ID)
    // Condi√ß√£o 3: Quem enviou esta mensagem de resposta N√ÉO sou eu mesmo (data.userId !== window.BBB_USER_ID)
    if (data.replyTo && mySentMessageIds.includes(data.replyTo.originalId) && data.userId !== window.BBB_USER_ID) {
        const replyMarker = document.createElement('span');
        replyMarker.className = 'msg-reply-marker';
        replyMarker.textContent = '@ respondeu sua mensagem';
        msg.insertBefore(replyMarker, msg.firstChild); // Adiciona o marcador no in√≠cio da bolha
    }
    // --- FIM DO C√ìDIGO CORRIGIDO PARA O MARCADOR ---

    // --- NOVO: Adicionar o nome do remetente como um elemento separado ---
    const senderNameElement = document.createElement('div');
    senderNameElement.className = 'message-sender-name';
    senderNameElement.textContent = data.user;
    msg.appendChild(senderNameElement); // Adiciona o nome no topo da mensagem

    // --- L√≥gica para exibir a mensagem respondida (replyTo) ---
        // --- L√≥gica para exibir a mensagem respondida (replyTo) ---
    if (data.replyTo && data.replyTo.originalId) { // IN√çCIO: NOVO C√ìDIGO - Verifica se originalId existe
        msg.classList.add('has-reply');
        const replyBox = document.createElement('div');
        replyBox.className = 'msg-reply-box';
        replyBox.dataset.replyToId = data.replyTo.originalId; // <-- NOVO C√ìDIGO: Salva o ID da mensagem original no HTML
        replyBox.innerHTML = `
            <span class="reply-name">${data.replyTo.user}</span>
            <span class="reply-text">${data.replyTo.message}</span>
        `;
        msg.appendChild(replyBox);
    }

        const messageContent = document.createElement('div');
    messageContent.className = 'message-content';
    // Use innerHTML para renderizar as hashtags formatadas
    messageContent.innerHTML = formatMessageWithHashtags(data.message); // Apenas o conte√∫do da mensagem, sem o nome
    msg.appendChild(messageContent);
    
    // ----------- IN√çCIO: ADICIONE ESTE BLOOCO DE C√ìDIGO -----------
    if (data.timestamp) {
        const date = new Date(data.timestamp);
        const hours = date.getHours().toString().padStart(2, '0');
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const timeElement = document.createElement('span');
        timeElement.className = 'msg-time';
        timeElement.textContent = `${hours}:${minutes}`;
        msg.appendChild(timeElement);
    }
    // ----------- FIM: ADICIONE ESTE BLOCO DE C√ìDIGO -----------

    messageBox.appendChild(msg);

    // üî¥ MODIFICA√á√ÉO AQUI: Apenas rola para o final se o usu√°rio n√£o estiver rolando para cima
    if (!isUserScrollingUp) {
        messageBox.scrollTop = messageBox.scrollHeight;
    }
    // üî¥ FIM DA MODIFICA√á√ÉO

    // üîé Verifica admin SEM atrasar a renderiza√ß√£o
    get(ref(db, "admins/" + data.userId)).then(snap => {
        if (snap.exists()) {
            msg.classList.add('admin-msg');
            // Altere para ajustar o nome do admin no novo elemento
            senderNameElement.textContent = `‚ú¶ ${data.user} [ADMIN]`;
        }
    });
});

    // IN√çCIO: NOVO C√ìDIGO - L√≥gica de Clique na Caixa de Resposta para Rolar e Destacar
    messageBox.addEventListener('click', (e) => {
        // Verifica se o clique ocorreu dentro de uma div com a classe 'msg-reply-box'
        const clickedReplyBox = e.target.closest('.msg-reply-box');

        // Se encontrou uma caixa de resposta clicada E ela possui o ID da mensagem original
        if (clickedReplyBox && clickedReplyBox.dataset.replyToId) {
            const originalMessageId = clickedReplyBox.dataset.replyToId;
            // Encontra a div da mensagem original usando o data-message-id
            const originalMessageElement = document.querySelector(`.msg[data-message-id="${originalMessageId}"]`);

            if (originalMessageElement) {
                // 1. Rola suavemente at√© a mensagem original
                originalMessageElement.scrollIntoView({
                    behavior: 'smooth', // Rolagem suave
                    block: 'center' // Tenta centralizar a mensagem na tela
                });

                // 2. Adiciona a classe de destaque
                originalMessageElement.classList.add('highlight');

                // 3. Remove o destaque ap√≥s alguns segundos (3 segundos = 3000 milissegundos)
                setTimeout(() => {
                    originalMessageElement.classList.remove('highlight');
                }, 3000); 
            } else {
                // Caso a mensagem original n√£o seja encontrada (pode ter sido deletada, por exemplo)
                console.warn(`[Scroll Reply] Mensagem original com ID ${originalMessageId} n√£o encontrada.`);
                // Opcional: Voc√™ pode adicionar um feedback visual para o usu√°rio aqui
            }
        }
    });
    // FIM: NOVO C√ìDIGO - L√≥gica de Clique na Caixa de Resposta para Rolar e Destacar

      
      /* AJUDA */
const btnAjuda = document.getElementById("btnAjuda");
const helpModal = document.getElementById("helpModal");
const closeHelp = document.getElementById("closeHelp");

btnAjuda.onclick = () => {
  helpModal.style.display = "flex"; // garante que o modal fique vis√≠vel
  helpModal.classList.remove("hide");
  helpModal.classList.add("show");
};

function fecharModal() {
  helpModal.classList.remove("show");
  helpModal.classList.add("hide");
  
  // Espera a anima√ß√£o terminar antes de ocultar totalmente
  helpModal.addEventListener("animationend", () => {
    if(helpModal.classList.contains("hide")){
      helpModal.style.display = "none"; // s√≥ aqui some do DOM
    }
  }, { once: true });
}

closeHelp.onclick = fecharModal;
helpModal.onclick = e => {
  if(e.target === helpModal) fecharModal();
};
</script>
  
  <script>
  document.querySelectorAll('.help-title').forEach(title => {
  title.addEventListener('click', () => {
    const card = title.parentElement;
    
    // Fecha todos os outros cards
    document.querySelectorAll('.help-card').forEach(c => {
      if(c !== card) c.classList.remove('active');
    });
    
    // Alterna o card clicado
    card.classList.toggle('active');
  });
});
        
        
            // ===== MENU LATERAL =====
const menuBtn = document.getElementById("menuBtn");
const sideMenu = document.getElementById("sideMenu");
const menuUsername = document.getElementById("menuUsername");

menuBtn.onclick = () => {
    sideMenu.classList.add("active");
};

sideMenu.onclick = (e) => {
    if (e.target === sideMenu) {
        sideMenu.classList.remove("active");
    }
};

// PUXA NOME DO USU√ÅRIO
const username = localStorage.getItem("chatName");

if (username) {
    menuUsername.textContent = username;
}

document.getElementById("menuSobre").onclick = () => {
    abrirModal("sobreModal");
};

document.getElementById("menuSuporte").onclick = () => {
    abrirModal("suporteModal");
};
    
    function abrirModal(id) {
  const modal = document.getElementById(id);
  modal.style.display = "flex";
  modal.classList.remove("hide");
  modal.classList.add("show");
}

function fecharModalGenerico(id) {
  const modal = document.getElementById(id);
  modal.classList.remove("show");
  modal.classList.add("hide");

  modal.addEventListener("animationend", () => {
    if (modal.classList.contains("hide")) {
      modal.style.display = "none";
    }
  }, { once: true });
}
    
    // üî¥ IN√çCIO: NOVO C√ìDIGO - L√≥gica do Scroll Inteligente e Bot√£o "Mensagens Recentes"

const SCROLL_THRESHOLD = 120; // Aproximadamente 120px do final
let isUserScrollingUp = false;
const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');

// Fun√ß√£o para checar se o usu√°rio est√° no final do chat
function isAtChatBottom() {
    return messageBox.scrollHeight - messageBox.scrollTop <= messageBox.clientHeight + SCROLL_THRESHOLD;
}

// Fun√ß√£o para rolar o chat para o final
function smoothScrollToBottom() {
    messageBox.scrollTo({
        top: messageBox.scrollHeight,
        behavior: 'smooth'
    });
}

// L√≥gica de scroll do chat
messageBox.addEventListener('scroll', () => {
    // Se o usu√°rio rolou para cima (e n√£o est√° perto do final)
    if (messageBox.scrollHeight - messageBox.scrollTop > messageBox.clientHeight + SCROLL_THRESHOLD) {
        isUserScrollingUp = true;
        scrollToBottomBtn.classList.add('show'); // Mostra o bot√£o
    } else {
        isUserScrollingUp = false;
        scrollToBottomBtn.classList.remove('show'); // Esconde o bot√£o se estiver no final
    }
});

// Clique no bot√£o "Mensagens recentes"
scrollToBottomBtn.addEventListener('click', () => {
    smoothScrollToBottom();
    isUserScrollingUp = false; // Garante que o auto-scroll seja reativado
    scrollToBottomBtn.classList.remove('show'); // Esconde o bot√£o
});

// üî¥ FIM: NOVO C√ìDIGO
      
</script>

</body>
    </html>
